**任务二描述：47分**

**使用CC2530单片机实现温湿度检测的系统。按接线图进行设备安装与部署，使用所给的代码利用IAR编程实现ZigBee黑板采集温湿度数据，并发送给串口，串口通过公对公转接线与 RS-232转RS485连接到M3的串口2，最后由NB-IoT节点将温湿度传感数据发送至云平台（与任务一在同一个云平台项目中显示）。**

**任务要求：**

打开工程源码目录下的工程”..\\work\\Task\\chuji_wkspc.eww”，把“Task”文件夹下的“test.c”添加到IAR工程中，确保编译成功(4分)，在test.c中完善代码实现以下功能：

1、ZigBee模块一上电，所有LED灯不亮。（3分）

2、定时时间要求使用定时器1，32MHz时钟频率，工作模式为模模式，128分频，通道0，定时器的时间周期为200ms。（7分）

3、设置串口通信，要求采用波特率115200，8位数据位，1位停止位，无校验位，无流控。（5分）

4、使用提供的void SHT_SmpSnValue(int8 \*tem, uint8 \*hum)函数，每2秒采集一次温湿度传感器数据并发送到串口，此时温湿度返回的值是16进制格式的数据，定时2秒用定时器1进行控制。使用USB转串口线把ZigBee黑板和PC机进行连接，把串口助手显示的温湿度数据进行截图保存至“图集.docx”中的5.png处。（8分）

5、将ZigBee模块通过公对公串口线和RS485转232转接头连接到M3的J5（串口2），NEWLab平台上先只放置M3主控模块，将M3的JP2拨向左边J3处以便跟底部的串口1连通，用USB串口线连接newlab与PC机，利用串口助手可以查看到温湿度数据和开关指令值，截图保存至“图集.docx”中的6.png处。（5分）

6、触摸温湿度传感器使温度达到0x16即22度或以上（值可以根据现场环境自行设定），ZigBee模块D3、M3的LED1亮。（5分）

7、在NEWLab平台上添加任务一的NB-IoT模块，等NB-IoT在云平台上线后，再将M3主控模块的JP2拨向J9处，并通过杜邦线与NB-IoT模块的UART1交叉连接（TX1-U1_RX ,RX1-U1_TX）。以上操作成功并完成后，NB-IoT模块的OLED屏上能显示出温湿度数据，云平台上显示出光照传感器、温湿度传感器数据,将云平台上传感数据界面截图保存至“图集.docx”中的7.png处。（10分）

**9、考试时间截止后，应确保“图集.docx”和源码工程文件已保存妥当，将“work”文件夹压缩成“work.zip”**
**文件，点击“上传文件”将压缩后的“work.zip”上传至服务器指定目录。**
